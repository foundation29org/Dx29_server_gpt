<div style="margin-bottom: 1%; padding-bottom: 2%;">
	<img align="right" width="100px" src="/img/logo-Dx29.png">
</div>			

DxGPT Server
===============================================================================================================================

#### 1. Overview
DxGPT is a diagnostic decision support software based on GPT-4. GPT-4 is an Artificial Intelligence (AI) language model developed by OpenAI. It is designed to generate text from previous input. This means that the software can generate a list of diseases from a description of symptoms. However, due to the characteristics of the model, there is a possibility that the software has errors. Therefore, it should not be used for medical use.

Once the list of diseases is generated, it can be completed with further information to refine the diagnosis. This includes collecting clinical data, performing laboratory tests, and gathering information from the medical record. This will help clinicians make a more informed decision about the diagnosis. It is important that users give us feedback on the use of the software so that we can improve the model. This is important because it helps us to better understand how the software is being used and how we can improve it.

We are currently working on developing new features for the software. We are looking for collaborators who want to investigate the use of these models in diagnostics. If you are interested, please contact us for more information.

#### 2. Current model accuracy

In a recent preliminary evaluation conducted by Foundation 29 using 200 synthetic patient cases generated by language models, DxGPT demonstrated some ability to suggest correct diagnoses of rare diseases. Specifically, when evaluated for strict accuracy (i.e., whether the correct diagnosis appeared in first position), DxGPT obtained an accuracy of 67.5%, getting the diagnosis right in 135 of the 200 cases. If a more flexible metric is considered, counting correct diagnoses in both the first and first 5 positions, the accuracy increases to 88.5% (177 out of 200 cases). While these initial results are encouraging, DxGPT is still at an early stage of development.

For more details on the evaluation methodology and results, please see our [GitHub repository and the associated article.](https://github.com/foundation29org/dxgpt_testing)

<br>
<br>

The client code is here: [Dx29 client](https://github.com/foundation29org/Dx29_client_gpt)
<p>&nbsp;</p>
<p>&nbsp;</p>


<div style="border-top: 1px solid !important;
	padding-top: 1% !important;
    padding-right: 1% !important;
    padding-bottom: 0.1% !important;">
	<div align="right">
		<img width="150px" src="/img/logo-foundation-twentynine-footer.png">
	</div>
	<div align="right" style="padding-top: 0.5% !important">
		<p align="right">
			Copyright © 2024
			<a style="color:#009DA0" href="https://www.foundation29.org/" target="_blank"> Foundation29</a>
		</p>
	</div>
<div>

# DxGPT API Server

## Contenerización y Despliegue

Este proyecto está configurado para funcionar con Docker y se puede desplegar en Azure Container Apps con gestión segura de secretos mediante los secretos nativos de Container Apps.

### Requisitos

- Docker y Docker Compose instalados
- Node.js 18.x (para desarrollo local sin Docker)
- Una suscripción de Azure (para despliegue en Azure Container Apps)
- Azure CLI instalado y configurado

### Variables de Entorno

El proyecto utiliza archivos de variables de entorno para cada entorno:

- `env.local`: Para desarrollo local
- `env.dev`: Para el entorno de desarrollo en Azure
- `env.prod`: Para el entorno de producción en Azure

Se ha creado un archivo `env.example` con todas las variables de entorno necesarias. Copia este archivo para crear los archivos específicos para cada entorno:

```bash
# Para desarrollo local
cp env.example env.local

# Para desarrollo en Azure
cp env.example env.dev

# Para producción en Azure
cp env.example env.prod
```

Luego edita cada archivo con los valores correspondientes para cada entorno. Asegúrate de incluir todas las variables necesarias como `API_MANAGEMENT_KEY`, `INSIGHTS`, `SERVER_KEY`, `TRANSLATION_KEY`, y sus variantes para cada entorno.

#### Gestión de Secretos en Azure Container Apps

Para el despliegue en Azure, todas las variables sensibles se gestionan de forma segura mediante los secretos nativos de Azure Container Apps:

1. Las variables sensibles se almacenan como secretos internos en Container Apps y se referencian mediante `keyvaultref`.
2. Las aplicaciones referencian estos secretos mediante la sintaxis `keyvaultref` para asegurar que las credenciales no se exponen en los logs ni en las configuraciones.
3. Los secretos están protegidos y no se exponen en los logs ni en las configuraciones.

### Despliegue en Azure Container Apps

1. Edita las variables en el archivo `azure-deploy-dev.sh` o `azure-deploy-prod.sh` según el entorno:
   - `ACR_NAME`: Nombre del Azure Container Registry
   - `RESOURCE_GROUP`: Nombre del grupo de recursos
   - `LOCATION`: Ubicación de Azure (ej. eastus)
   - `CONTAINER_APP_ENV`: Nombre del entorno de Container Apps

2. Asegúrate de tener los archivos `env.dev` y `env.prod` configurados con todas las variables necesarias.

3. Ejecuta el script de despliegue correspondiente al entorno:

```bash
# En Linux/macOS
chmod +x azure-deploy-dev.sh
./azure-deploy-dev.sh

# Para producción
chmod +x azure-deploy-prod.sh
./azure-deploy-prod.sh

# En Windows (PowerShell)
# Necesitarás adaptar el script a PowerShell o usar WSL
```

El script:
- Creará un grupo de recursos si no existe
- Creará un Azure Container Registry si no existe
- Creará un entorno de Container Apps si no existe
- Construirá y publicará las imágenes Docker
- Desplegará las aplicaciones con los secretos configurados
- Configurará las variables de entorno para referenciar los secretos

### Seguridad

Las credenciales y secretos se almacenan de forma segura como secretos internos de Container Apps y se referencian en las variables de entorno mediante `keyvaultref`. Esto mantiene las credenciales protegidas y separadas del código de la aplicación.

### Ejecución Local con Docker

Para ejecutar el proyecto localmente usando Docker:

```bash
# Entorno de desarrollo local (puerto 8443)
docker-compose up app-local

# Entorno de desarrollo para Azure
docker-compose up app-dev

# Entorno de producción
docker-compose up app-prod
```

### Construcción de Imágenes

```bash
# Construir imagen de desarrollo
docker build -t dxgpt-api:dev -f Dockerfile.dev .

# Construir imagen de producción
docker build -t dxgpt-api:prod -f Dockerfile .
```
